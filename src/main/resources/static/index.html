<!doctype html>
<html lang="en">
<head>
 <style>
.badge{
    position: absolute;
    right:0;
    margin: 0 5px;
}
</style>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SLF REPORT</title>
  <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script type="text/javascript" src="https://cdn.canvasjs.com/jquery.canvasjs.min.js"></script>
  <script>
  
  $( function() {
	    var dateFormat = "yyyy-mm-dd",
	      from = $( "#from" )
	        .datepicker({
	          defaultDate: "+1w",
	          changeMonth: true,
	          numberOfMonths: 1
	        })
	        .on( "change", function() {
	          to.datepicker( "option", "minDate", getDate( this ) );
	        }),
	      to = $( "#to" ).datepicker({
	        defaultDate: "+1w",
	        changeMonth: true,
	        numberOfMonths: 1
	      })
	      .on( "change", function() {
	        from.datepicker( "option", "maxDate", getDate( this ) );
	      });
	 
	    function getDate( element ) {
	      var date;
	      try {
	        date = $('#from').datepicker.parseDate( dateFormat, element.value );
	      } catch( error ) {
	        date = null;
	      }
	 
	      return date;
	    }
	  } );
  
  $(document).ready(function(){
	  $("button").click(function(){
		  var dateFormat = "yyyy-mm-dd";
		  var fromDt = new Date($('#from').datepicker("getDate"));
		  var toDt = new Date($('#to').datepicker("getDate"));
		 
		  var fromDate=convertDate(fromDt);
		  var toDate=convertDate(toDt);
		  
	    $.ajax({url: "../slfReport?fromDate="+fromDate+"&toDate="+toDate,
	    		type: 'GET',  
	    		success: function(result){
			      $("#totalNoOfInident").html(createTable(result.totalNoOfIncident));
			      $("#taskIncident").html(createTable(result.taskIncident));
			      $("#openShiftIncident").html(createTable(result.openShiftIncident));
			      $("#landingIncident").html(createTable(result.landingIncident));
			      $("#batchesIncident").html(createTable(result.batchesIncident));
			      $("#idsIncident").html(createTable(result.idsIncident));
			      $("#dataClarificationIncident").html(createTable(result.dataClarificationIncident));
			      $("#dataCorrectionIncident").html(createTable(result.dataCorrectionIncident));
			      
			      $("#totalNoOfInidentTotal").text("Total no. "+getTotal(result.totalNoOfIncident));
			      $("#taskIncidentTotal").text("Total no. "+getTotal(result.taskIncident));
			      $("#openShiftIncidentTotal").text("Total no. "+getTotal(result.openShiftIncident));
			      $("#landingIncidentTotal").text("Total no. "+getTotal(result.landingIncident));
			      $("#batchesIncidentTotal").text("Total no. "+getTotal(result.batchesIncident));
			      $("#idsIncidentTotal").text("Total no. "+getTotal(result.idsIncident));
			      $("#dataClarificationIncidentTotal").text("Total no. "+getTotal(result.dataClarificationIncident));
			      $("#dataCorrectionIncidentTotal").text("Total no. "+getTotal(result.dataCorrectionIncident));
	    }});
	    
	  });
	  
	  function createTable(obj){
		  var text= "<table class='table'><tr><th>Priority</th><th>Value</th></tr>";
		  
		    	for(var key in obj){
		    		if(obj[key]!="0"){
		    			text+="<tr style='background-color: rgba(72, 113, 248, 0.068);'><td>"+key+"</td><td>"+obj[key]+"</td></tr>"
		    		}
		    	}
  			text+="</table>";
  			return text;
	  }
	  function getTotal(obj){
		  var total = 0;
		  for(var key in obj){
	    		if(obj[key]!="0"){
	    			total += Number(obj[key]);
	    		}
	    	}
		  return total;
	  }
	  function convertDate(date) {
		  var yyyy = date.getFullYear().toString();
		  var mm = (date.getMonth()+1).toString();
		  var dd  = date.getDate().toString();

		  var mmChars = mm.split('');
		  var ddChars = dd.split('');

		  return yyyy + '-' + (mmChars[1]?mm:"0"+mmChars[0]) + '-' + (ddChars[1]?dd:"0"+ddChars[0]);
		}

	});
  window.onload = function () {

//Better to construct options first and then pass it as a parameter
var options = {
	animationEnabled: true,
	title:{
		text: "Total Number of Incidents"
	},
	axisY:{
		title:"Number Of Incidents"
	},
	toolTip: {
		shared: true,
		reversed: true
	},
	data: [{
		type: "stackedColumn",
		name: "Anthracite and Bituminous",
		showInLegend: "true",
		yValueFormatString: " ## incidents",
		dataPoints: [
			{ y: 111338 , label: "USA" },
			{ y: 49088, label: "Russia" },
			{ y: 62200, label: "China" },
			{ y: 90085, label: "India" },
			{ y: 38600, label: "Australia" },
			{ y: 48750, label: "SA" }
		]
	},
	{
		type: "stackedColumn",
		name: "SubBituminous and Lignite",
		showInLegend: "true",
		yValueFormatString: " ## incidents",
		dataPoints: [
			{ y: 135305 , label: "USA" },
			{ y: 107922, label: "Russia" },
			{ y: 52300, label: "China" },
			{ y: 3360, label: "India" },
			{ y: 39900, label: "Australia" },
			{ y: 0, label: "SA" }
		]
	}]
};

$("#chartContainer").CanvasJSChart(options);
}
  </script>


</head>
<body>



 <div class="container">

</div>

<div class="row justify-content-between align-items-center mb-5">
  <div class="col flex-shrink-0 mb-5 mb-md-0">
    <h1 class="display-4 mb-0">SLF Dashboard</h1>
    <div class="text-muted">SLF Report</div>
  </div>
  <div class="col-12 col-md-auto">
    <div class="d-flex flex-column flex-sm-row gap-3">
      <label for="from">From</label>
      <input type="text" id="from" name="from">
      <label for="to">to</label>
      <input type="text" id="to" name="to">
      <button>submit</button>
    </div>
  </div>
</div>

<div>
  <div id="chartContainer" style="height: 300px; width: 100%;"></div>

<div class="container mt-3">
<div class="card">
  <div class="card-header">Total Number of Incidents   <span id="totalNoOfInidentTotal" class="badge bg-primary"></span></div>
  <div class="card-body" id="totalNoOfInident"></div>
</div>
</div>

<div class="container">
<div class="card">
  <div class="card-header">Task Incidents<span id="taskIncidentTotal" class="badge bg-primary"></span></div>
  <div class="card-body" id="taskIncident"></div>
</div>
</div>
<div class="container">
<div class="card">
  <div class="card-header">Open Shift Incidents<span id="openShiftIncidentTotal" class="badge bg-primary"></span></div>
  <div class="card-body" id="openShiftIncident"></div>
</div>
</div>
<div class="container">
<div class="card">
  <div class="card-header">Landing Incidents<span id="landingIncidentTotal" class="badge bg-primary"></span></div>
  <div class="card-body" id="landingIncident"></div>
</div>
</div>
<div class="container">
<div class="card">
  <div class="card-header">Batches Incidents<span id="batchesIncidentTotal" class="badge bg-primary"></span></div>
  <div class="card-body" id="batchesIncident"></div>
</div>
</div>
<div class="container">
<div class="card">
  <div class="card-header">IDRS Incidents<span id="idsIncidentTotal" class="badge bg-primary"></span></div>
  <div class="card-body" id="idsIncident"></div>
</div>
</div>
<div class="container">
<div class="card">
  <div class="card-header">Data Clarification  Incidents<span id="dataClarificationIncidentTotal" class="badge bg-primary"></span></div>
  <div class="card-body" id="dataClarificationIncident"></div>
</div>
</div>
<div class="container">
<div class="card">
  <div class="card-header">Data Correction Incidents<span id="dataCorrectionIncidentTotal" class="badge bg-primary"></span></div>
  <div class="card-body" id="dataCorrectionIncident"></div>
</div>
</div>



</div>
 
</body>
</html>